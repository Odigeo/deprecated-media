<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>class Api - Ocean</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  

  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/ocean/api.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link"><a href="Object.html">Object</a>
  
</nav>

    
    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li ><a href="#method-c-authenticate">::authenticate</a>
    
    <li ><a href="#method-c-authorization_string">::authorization_string</a>
    
    <li ><a href="#method-c-ban">::ban</a>
    
    <li ><a href="#method-c-call">::call</a>
    
    <li ><a href="#method-c-call_p">::call_p</a>
    
    <li ><a href="#method-c-decode_credentials">::decode_credentials</a>
    
    <li ><a href="#method-c-delete">::delete</a>
    
    <li ><a href="#method-c-encode_credentials">::encode_credentials</a>
    
    <li ><a href="#method-c-get">::get</a>
    
    <li ><a href="#method-c-map_authorization">::map_authorization</a>
    
    <li ><a href="#method-c-permitted-3F">::permitted?</a>
    
    <li ><a href="#method-c-post">::post</a>
    
    <li ><a href="#method-c-purge">::purge</a>
    
    <li ><a href="#method-c-put">::put</a>
    
    <li ><a href="#method-c-token">::token</a>
    
    <li ><a href="#method-c-version_for">::version_for</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./README_rdoc.html">README</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./ActionController.html">ActionController</a>
  
    <li><a href="./ActiveRecord.html">ActiveRecord</a>
  
    <li><a href="./ActiveSupport.html">ActiveSupport</a>
  
    <li><a href="./AliveController.html">AliveController</a>
  
    <li><a href="./Api.html">Api</a>
  
    <li><a href="./ApiResource.html">ApiResource</a>
  
    <li><a href="./ApiResource/ClassMethods.html">ApiResource::ClassMethods</a>
  
    <li><a href="./ApplicationController.html">ApplicationController</a>
  
    <li><a href="./ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="./ErrorsController.html">ErrorsController</a>
  
    <li><a href="./Faraday.html">Faraday</a>
  
    <li><a href="./Logger.html">Logger</a>
  
    <li><a href="./Object.html">Object</a>
  
    <li><a href="./Ocean.html">Ocean</a>
  
    <li><a href="./Ocean/OceanResourceController.html">Ocean::OceanResourceController</a>
  
    <li><a href="./Ocean/OceanResourceController/ClassMethods.html">Ocean::OceanResourceController::ClassMethods</a>
  
    <li><a href="./Ocean/OceanResourceModel.html">Ocean::OceanResourceModel</a>
  
    <li><a href="./Ocean/OceanResourceModel/ClassMethods.html">Ocean::OceanResourceModel::ClassMethods</a>
  
    <li><a href="./Ocean/Railtie.html">Ocean::Railtie</a>
  
    <li><a href="./Ocean/Railtie/File.html">Ocean::Railtie::File</a>
  
    <li><a href="./Ocean/Railtie/Rails.html">Ocean::Railtie::Rails</a>
  
    <li><a href="./Ocean/Railtie/Rails/Rack.html">Ocean::Railtie::Rails::Rack</a>
  
    <li><a href="./OceanApplicationController.html">OceanApplicationController</a>
  
    <li><a href="./OceanScaffoldGenerator.html">OceanScaffoldGenerator</a>
  
    <li><a href="./OceanSetupGenerator.html">OceanSetupGenerator</a>
  
    <li><a href="./RSpec.html">RSpec</a>
  
    <li><a href="./SelectiveRackLogger.html">SelectiveRackLogger</a>
  
    <li><a href="./ZeroLog.html">ZeroLog</a>
  
    <li><a href="./ZeromqLogger.html">ZeromqLogger</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class Api</h1>

  <div id="description" class="description">
    
<p>This class encapsulates all logic for calling other API services.</p>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <!-- Constants -->
    <section id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt id="DEFAULT_ACTIONS">DEFAULT_ACTIONS
        
        <dd class="description"><p>These are the default controller actions. The purpose of this constant is
to map action names to hyperlink and HTTP method (for authorisation
purposes). Don&#39;t be alarmed by the non-standard GET* - it&#39;s purely
symbolic and is never used as an actual HTTP method.  We need it to
differentiate between a GET of a member and a GET of a collection of
members.  The <code>extra_actions</code> keyword in
<code>ocean_resource_controller</code> follows the same format.</p>
        
      
      </dl>
    </section>
    

    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-authenticate" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">authenticate</span><span
            class="method-args">(username=API_USER, password=API_PASSWORD)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Authenticates against the Auth service (which must be deployed and running)
with a given <code>username</code> and <code>password</code>. If
successful, the authentication token is returned. The token is also
assigned to the instance variable @token. If not successful,
<code>nil</code> is returned.</p>
          
          

          
          <div class="method-source-code" id="authenticate-source">
            <pre><span class="ruby-comment"># File lib/ocean/api.rb, line 151</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">authenticate</span>(<span class="ruby-identifier">username</span>=<span class="ruby-constant">API_USER</span>, <span class="ruby-identifier">password</span>=<span class="ruby-constant">API_PASSWORD</span>)
  <span class="ruby-identifier">response</span> = <span class="ruby-constant">Api</span>.<span class="ruby-identifier">post</span>(<span class="ruby-value">:auth</span>, <span class="ruby-string">&quot;/authentications&quot;</span>, <span class="ruby-keyword">nil</span>, 
                             {<span class="ruby-string">&#39;X-API-Authenticate&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">encode_credentials</span>(<span class="ruby-identifier">username</span>, <span class="ruby-identifier">password</span>)})
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">status</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">201</span>
    <span class="ruby-ivar">@token</span> = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">body</span>[<span class="ruby-string">&#39;authentication&#39;</span>][<span class="ruby-string">&#39;token&#39;</span>]
  <span class="ruby-keyword">when</span> <span class="ruby-value">400</span>
    <span class="ruby-comment"># Malformed credentials. Don&#39;t repeat the request.</span>
    <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">403</span>
    <span class="ruby-comment"># Does not authenticate. Don&#39;t repeat the request.</span>
    <span class="ruby-keyword">nil</span> 
  <span class="ruby-keyword">when</span> <span class="ruby-value">500</span>
    <span class="ruby-comment"># Error. Don&#39;t repeat. </span>
    <span class="ruby-keyword">nil</span>   
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment"># Should never end up here.</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;Authentication weirdness&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- authenticate-source -->
          
        </div>

        

        
      </div><!-- authenticate-method -->

    
      <div id="method-c-authorization_string" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">authorization_string</span><span
            class="method-args">(extra_actions, controller, action, app="*", context="*", service=APP_NAME)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns an authorisation string suitable for use in calls to <a
href="Api.html#method-c-permitted-3F">::permitted?</a>.  The
<code>extra_actions</code> arg holds the extra actions as defined in the <a
href="Ocean.html">Ocean</a> controller; it must be included here so that
actions can be mapped to the proper hyperlink and verb. The
<code>controller</code> and <code>action</code> args are mandatory. The
<code>app</code> and <code>context</code> args are optional and will
default to “*”. The last arg, <code>service</code>, defaults to the name of
the service itself.</p>
          
          

          
          <div class="method-source-code" id="authorization_string-source">
            <pre><span class="ruby-comment"># File lib/ocean/api.rb, line 226</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">authorization_string</span>(<span class="ruby-identifier">extra_actions</span>, <span class="ruby-identifier">controller</span>, <span class="ruby-identifier">action</span>, <span class="ruby-identifier">app</span>=<span class="ruby-string">&quot;*&quot;</span>, <span class="ruby-identifier">context</span>=<span class="ruby-string">&quot;*&quot;</span>, <span class="ruby-identifier">service</span>=<span class="ruby-constant">APP_NAME</span>)
  <span class="ruby-identifier">app</span> = <span class="ruby-string">&#39;*&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">app</span>.<span class="ruby-identifier">blank?</span>
  <span class="ruby-identifier">context</span> = <span class="ruby-string">&#39;*&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">context</span>.<span class="ruby-identifier">blank?</span>
  <span class="ruby-identifier">hyperlink</span>, <span class="ruby-identifier">verb</span> = <span class="ruby-constant">Api</span>.<span class="ruby-identifier">map_authorization</span>(<span class="ruby-identifier">extra_actions</span>, <span class="ruby-identifier">controller</span>, <span class="ruby-identifier">action</span>)
  <span class="ruby-node">&quot;#{service}:#{controller}:#{hyperlink}:#{verb}:#{app}:#{context}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- authorization_string-source -->
          
        </div>

        

        
      </div><!-- authorization_string-method -->

    
      <div id="method-c-ban" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ban</span><span
            class="method-args">(path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Makes an internal BAN call to all Varnish instances. The call is made in
parallel. Varnish will only accept PURGE requests coming from the local
network.</p>
          
          

          
          <div class="method-source-code" id="ban-source">
            <pre><span class="ruby-comment"># File lib/ocean/api.rb, line 139</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">ban</span>(<span class="ruby-identifier">path</span>)     
  <span class="ruby-constant">LOAD_BALANCERS</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">host</span><span class="ruby-operator">|</span> 
    <span class="ruby-identifier">call_p</span>(<span class="ruby-node">&quot;http://#{host}&quot;</span>, <span class="ruby-value">:ban</span>, <span class="ruby-identifier">path</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- ban-source -->
          
        </div>

        

        
      </div><!-- ban-method -->

    
      <div id="method-c-call" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">call</span><span
            class="method-args">(host_url, http_method, resource_name, path, args={}, headers={})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Makes a HTTP request to <code>host_url</code> using the HTTP method
<code>method</code>. The <code>resource_name</code> is used to obtain the
latest version string of the resource. The arg <code>path</code> is the
local path, <code>args</code> is a hash of query args, and
<code>headers</code> a hash of extra HTTP headers.</p>

<p>Returns the response in its entirety so that the caller can examine its
status and body.</p>
          
          

          
          <div class="method-source-code" id="call-source">
            <pre><span class="ruby-comment"># File lib/ocean/api.rb, line 58</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">host_url</span>, <span class="ruby-identifier">http_method</span>, <span class="ruby-identifier">resource_name</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">args</span>={}, <span class="ruby-identifier">headers</span>={})
  <span class="ruby-comment"># Set up the connection parameters</span>
  <span class="ruby-identifier">conn</span> = <span class="ruby-constant">Faraday</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">host_url</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">c</span>.<span class="ruby-identifier">response</span> <span class="ruby-value">:json</span>, <span class="ruby-value">:content_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-regexp">/\bjson$/</span>    <span class="ruby-comment"># Convert the response body to JSON</span>
    <span class="ruby-identifier">c</span>.<span class="ruby-identifier">adapter</span> <span class="ruby-constant">Faraday</span>.<span class="ruby-identifier">default_adapter</span>               <span class="ruby-comment"># Use net-http</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">api_version</span> = <span class="ruby-identifier">version_for</span> <span class="ruby-identifier">resource_name</span>
  <span class="ruby-identifier">path</span> = <span class="ruby-node">&quot;/#{api_version}#{path}&quot;</span>
  <span class="ruby-comment"># Make the call. TODO: retries?</span>
  <span class="ruby-identifier">response</span> = <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">http_method</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">args</span>, <span class="ruby-identifier">headers</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">request</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">request</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Accept&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
    <span class="ruby-identifier">request</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">response</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- call-source -->
          
        </div>

        

        
      </div><!-- call-method -->

    
      <div id="method-c-call_p" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">call_p</span><span
            class="method-args">(url, http_method, path, args={}, headers={})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Like <a href="Api.html#method-c-call">::call</a>, but makes the requests in
parallel. (Parallel calls not implemented yet.)</p>
          
          

          
          <div class="method-source-code" id="call_p-source">
            <pre><span class="ruby-comment"># File lib/ocean/api.rb, line 118</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">call_p</span>(<span class="ruby-identifier">url</span>, <span class="ruby-identifier">http_method</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">args</span>={}, <span class="ruby-identifier">headers</span>={})
  <span class="ruby-identifier">conn</span> = <span class="ruby-constant">Faraday</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">url</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">c</span>.<span class="ruby-identifier">adapter</span> <span class="ruby-constant">Faraday</span>.<span class="ruby-identifier">default_adapter</span>               <span class="ruby-comment"># Use net-http</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">http_method</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">args</span>, <span class="ruby-identifier">headers</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- call_p-source -->
          
        </div>

        

        
      </div><!-- call_p-method -->

    
      <div id="method-c-decode_credentials" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">decode_credentials</span><span
            class="method-args">(encoded)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Takes encoded credentials (e.g. by <a
href="Api.html#method-c-encode_credentials">::encode_credentials</a>) and
returns a two-element array where the first element is the username and the
second is the password. If the encoded credentials are missing or can&#39;t
be decoded properly, [“”, “”] is returned. This allows you to write:</p>

<pre>un, pw = Api.decode_credentials(creds)
raise &quot;Please supply your username and password&quot; if un.blank? || pw.blank?</pre>
          
          

          
          <div class="method-source-code" id="decode_credentials-source">
            <pre><span class="ruby-comment"># File lib/ocean/api.rb, line 191</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">decode_credentials</span>(<span class="ruby-identifier">encoded</span>)
  <span class="ruby-keyword">return</span> [<span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;&quot;</span>] <span class="ruby-keyword">unless</span> <span class="ruby-identifier">encoded</span>
  <span class="ruby-identifier">username</span>, <span class="ruby-identifier">password</span> = <span class="ruby-operator">::</span><span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span>(<span class="ruby-identifier">encoded</span>).<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;:&#39;</span>, <span class="ruby-value">2</span>)
  [<span class="ruby-identifier">username</span> <span class="ruby-operator">||</span> <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-identifier">password</span> <span class="ruby-operator">||</span> <span class="ruby-string">&quot;&quot;</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- decode_credentials-source -->
          
        </div>

        

        
      </div><!-- decode_credentials-method -->

    
      <div id="method-c-delete" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Convenience method to make an internal DELETE request to the <a
href="Ocean.html">Ocean</a> <a href="Api.html">Api</a>. The
<code>resource_name</code> is used to obtain the latest version string of
the resource. The arg <code>path</code> is the local path,
<code>args</code> is a hash of query args, and <code>headers</code> a hash
of extra HTTP headers.</p>

<p>Returns the response in its entirety so that the caller can examine its
status and body.</p>
          
          

          
          <div class="method-source-code" id="delete-source">
            <pre><span class="ruby-comment"># File lib/ocean/api.rb, line 112</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>) <span class="ruby-identifier">call</span>(<span class="ruby-constant">INTERNAL_OCEAN_API_URL</span>, <span class="ruby-value">:delete</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>); <span class="ruby-keyword">end</span></pre>
          </div><!-- delete-source -->
          
        </div>

        

        
      </div><!-- delete-method -->

    
      <div id="method-c-encode_credentials" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">encode_credentials</span><span
            class="method-args">(username, password)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Encodes a username and password for authentication in the format used for
standard HTTP  authentication. The encoding can be reversed and is intended
only to lightly mask the credentials so that they&#39;re not immediately
apparent when reading logs.</p>
          
          

          
          <div class="method-source-code" id="encode_credentials-source">
            <pre><span class="ruby-comment"># File lib/ocean/api.rb, line 178</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">encode_credentials</span>(<span class="ruby-identifier">username</span>, <span class="ruby-identifier">password</span>)
  <span class="ruby-operator">::</span><span class="ruby-constant">Base64</span>.<span class="ruby-identifier">strict_encode64</span> <span class="ruby-node">&quot;#{username}:#{password}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- encode_credentials-source -->
          
        </div>

        

        
      </div><!-- encode_credentials-method -->

    
      <div id="method-c-get" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Convenience method to make an internal GET request to the <a
href="Ocean.html">Ocean</a> <a href="Api.html">Api</a>. The
<code>resource_name</code> is used to obtain the latest version string of
the resource. The arg <code>path</code> is the local path,
<code>args</code> is a hash of query args, and <code>headers</code> a hash
of extra HTTP headers.</p>

<p>Returns the response in its entirety so that the caller can examine its
status and body.</p>
          
          

          
          <div class="method-source-code" id="get-source">
            <pre><span class="ruby-comment"># File lib/ocean/api.rb, line 82</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)    <span class="ruby-identifier">call</span>(<span class="ruby-constant">INTERNAL_OCEAN_API_URL</span>, <span class="ruby-value">:get</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>);    <span class="ruby-keyword">end</span></pre>
          </div><!-- get-source -->
          
        </div>

        

        
      </div><!-- get-method -->

    
      <div id="method-c-map_authorization" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">map_authorization</span><span
            class="method-args">(extra_actions, controller, action)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the hyperlink and HTTP method to use for an <code>action</code> in
a certain <code>controller</code>. First, the <code>DEFAULT_ACTIONS</code>
are searched, then any extra actions defined for the controller. Raises an
exception if the action can&#39;t be found.</p>
          
          

          
          <div class="method-source-code" id="map_authorization-source">
            <pre><span class="ruby-comment"># File lib/ocean/api.rb, line 256</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">map_authorization</span>(<span class="ruby-identifier">extra_actions</span>, <span class="ruby-identifier">controller</span>, <span class="ruby-identifier">action</span>)
  <span class="ruby-constant">DEFAULT_ACTIONS</span>[<span class="ruby-identifier">action</span>] <span class="ruby-operator">||</span>
  <span class="ruby-identifier">extra_actions</span>[<span class="ruby-identifier">controller</span>][<span class="ruby-identifier">action</span>] <span class="ruby-operator">||</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-comment">#&quot;The #{controller} lacks an extra_action declaration for #{action}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- map_authorization-source -->
          
        </div>

        

        
      </div><!-- map_authorization-method -->

    
      <div id="method-c-permitted-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">permitted?</span><span
            class="method-args">(token, args={})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Performs authorisation against the Auth service. The <code>token</code>
must be a token received as a  result of a prior authentication operation.
The args should be in the form</p>

<pre>query: &quot;service:controller:hyperlink:verb:app:context&quot;</pre>

<p>e.g.</p>

<pre>Api.permitted?(@token, query: &quot;cms:texts:self:GET:*:*&quot;)</pre>

<p><a href="Api.html#method-c-authorization_string">::authorization_string</a>
can be used to produce the query string.</p>

<p>Returns the HTTP response as-is, allowing the caller to examine the status
code and messages, and also the body.</p>
          
          

          
          <div class="method-source-code" id="permitted-3F-source">
            <pre><span class="ruby-comment"># File lib/ocean/api.rb, line 212</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">permitted?</span>(<span class="ruby-identifier">token</span>, <span class="ruby-identifier">args</span>={})
  <span class="ruby-identifier">raise</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">token</span>
  <span class="ruby-identifier">response</span> = <span class="ruby-constant">Api</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value">:auth</span>, <span class="ruby-node">&quot;/authentications/#{token}&quot;</span>, <span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">response</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- permitted-3F-source -->
          
        </div>

        

        
      </div><!-- permitted-3F-method -->

    
      <div id="method-c-post" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">post</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Convenience method to make an internal POST request to the <a
href="Ocean.html">Ocean</a> <a href="Api.html">Api</a>. The
<code>resource_name</code> is used to obtain the latest version string of
the resource. The arg <code>path</code> is the local path,
<code>args</code> is a hash of query args, and <code>headers</code> a hash
of extra HTTP headers.</p>

<p>Returns the response in its entirety so that the caller can examine its
status and body.</p>
          
          

          
          <div class="method-source-code" id="post-source">
            <pre><span class="ruby-comment"># File lib/ocean/api.rb, line 92</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">post</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)   <span class="ruby-identifier">call</span>(<span class="ruby-constant">INTERNAL_OCEAN_API_URL</span>, <span class="ruby-value">:post</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>);   <span class="ruby-keyword">end</span></pre>
          </div><!-- post-source -->
          
        </div>

        

        
      </div><!-- post-method -->

    
      <div id="method-c-purge" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">purge</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Makes an internal PURGE call to all Varnish instances. The call is made in
parallel. Varnish will only accept PURGE requests coming from the local
network.</p>
          
          

          
          <div class="method-source-code" id="purge-source">
            <pre><span class="ruby-comment"># File lib/ocean/api.rb, line 129</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">purge</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)  
  <span class="ruby-constant">LOAD_BALANCERS</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">host</span><span class="ruby-operator">|</span> 
    <span class="ruby-identifier">call_p</span>(<span class="ruby-node">&quot;http://#{host}&quot;</span>, <span class="ruby-value">:purge</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- purge-source -->
          
        </div>

        

        
      </div><!-- purge-method -->

    
      <div id="method-c-put" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">put</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Convenience method to make an internal PUT request to the <a
href="Ocean.html">Ocean</a> <a href="Api.html">Api</a>. The
<code>resource_name</code> is used to obtain the latest version string of
the resource. The arg <code>path</code> is the local path,
<code>args</code> is a hash of query args, and <code>headers</code> a hash
of extra HTTP headers.</p>

<p>Returns the response in its entirety so that the caller can examine its
status and body.</p>
          
          

          
          <div class="method-source-code" id="put-source">
            <pre><span class="ruby-comment"># File lib/ocean/api.rb, line 102</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">put</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)    <span class="ruby-identifier">call</span>(<span class="ruby-constant">INTERNAL_OCEAN_API_URL</span>, <span class="ruby-value">:put</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>);    <span class="ruby-keyword">end</span></pre>
          </div><!-- put-source -->
          
        </div>

        

        
      </div><!-- put-method -->

    
      <div id="method-c-token" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">token</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Given that this service has authenticated successfully with the Auth
service, returns the token returned as part of the authentication response.</p>
          
          

          
          <div class="method-source-code" id="token-source">
            <pre><span class="ruby-comment"># File lib/ocean/api.rb, line 46</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">token</span>
  <span class="ruby-ivar">@token</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- token-source -->
          
        </div>

        

        
      </div><!-- token-method -->

    
      <div id="method-c-version_for" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">version_for</span><span
            class="method-args">(resource_name)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>When given a symbol or string naming a resource, returns a string  such as
<code>v1</code> naming the latest version for the resource.</p>
          
          

          
          <div class="method-source-code" id="version_for-source">
            <pre><span class="ruby-comment"># File lib/ocean/api.rb, line 38</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">version_for</span>(<span class="ruby-identifier">resource_name</span>)
  <span class="ruby-constant">API_VERSIONS</span>[<span class="ruby-identifier">resource_name</span>.<span class="ruby-identifier">to_s</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">API_VERSIONS</span>[<span class="ruby-string">&#39;_default&#39;</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- version_for-source -->
          
        </div>

        

        
      </div><!-- version_for-method -->

    
    </section><!-- public-class-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 4.0.0.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

